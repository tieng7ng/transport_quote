# Documentation Technique et Fonctionnelle (SimplifiÃ©e)
## Application de GÃ©nÃ©ration de Devis Transport

**Version** : 2.1.0
**Date** : Janvier 2026
**Stack** : Python + FastAPI

---

## Statut d'implÃ©mentation

| Module | Statut | Description |
|--------|--------|-------------|
| Gestion Partenaires | âœ… Complet | CRUD + Suppression tarifs |
| Import Tarifs | âœ… Complet | CSV, Excel, PDF + Validation |
| Recherche (Matching) | âœ… Complet | Filtrage + AutocomplÃ©tion villes |
| Validation flexible | âœ… Complet | Code postal OU ville |
| Tri rÃ©sultats | â³ En cours | Prix, DÃ©lai |
| **Devis Clients (Panier)** | âœ… Complet | Liste, DÃ©tail, Ã‰dition, Sidebar |
| GÃ©nÃ©ration PDF | âŒ Non dÃ©marrÃ© | Export PDF du devis |
| Envoi Email | âŒ Non dÃ©marrÃ© | Envoi devis au client |

---

## Table des matiÃ¨res

1. [PrÃ©sentation](#1-prÃ©sentation)
2. [Architecture simplifiÃ©e](#2-architecture-simplifiÃ©e)
3. [Modules fonctionnels](#3-modules-fonctionnels)
4. [Interfaces Utilisateur](#4-interfaces-utilisateur)
5. [Cas d'usage](#5-cas-dusage)
6. [Flux de donnÃ©es](#6-flux-de-donnÃ©es)
7. [ModÃ¨le de donnÃ©es](#7-modÃ¨le-de-donnÃ©es)
8. [API Reference](#8-api-reference)
9. [Stack technique](#9-stack-technique)
10. [DÃ©ploiement](#10-dÃ©ploiement)

---

## 1. PrÃ©sentation

### 1.1 Objectif

Application permettant de :
1. **Importer** les tarifs des transporteurs depuis des fichiers (PDF, Excel, CSV)
2. **Rechercher** les meilleures offres pour un trajet
3. **GÃ©nÃ©rer** et envoyer des devis aux clients

### 1.2 Acteurs

| Acteur | RÃ´le |
|--------|------|
| **Administrateur** | Importe les fichiers tarifs des partenaires |
| **Client** | Recherche des offres et reÃ§oit des devis |

### 1.3 Flux simplifiÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Partenaire  â”‚     â”‚    Admin     â”‚     â”‚   SystÃ¨me    â”‚     â”‚   Client     â”‚
â”‚  (externe)   â”‚     â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚ Envoie fichier     â”‚                    â”‚                    â”‚
       â”‚ (email/FTP)        â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚ Upload fichier     â”‚                    â”‚
       â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ Parse + Valide     â”‚
       â”‚                    â”‚                    â”‚ + Stocke           â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚<â”€â”€ Rapport import â”€â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚<â”€â”€â”€ Recherche â”€â”€â”€â”€â”€â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€ RÃ©sultats â”€â”€â”€â”€>â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚<â”€â”€â”€ Demande devis â”€â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€ PDF + Email â”€â”€>â”‚
```

---

## 2. Architecture simplifiÃ©e

### 2.1 Vue d'ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               APPLICATION                                  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       Interface Web (Admin)                          â”‚  â”‚
â”‚  â”‚                  Upload fichiers + Consultation                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                             API REST                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Module Import   â”‚  â”‚  Module Matching â”‚  â”‚ Module Generator â”‚          â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚  â”‚  â€¢ CSV Parser    â”‚  â”‚  â€¢ Recherche     â”‚  â”‚ â€¢ Templates      â”‚          â”‚
â”‚  â”‚  â€¢ Excel Parser  â”‚  â”‚  â€¢ Scoring       â”‚  â”‚ â€¢ PDF            â”‚          â”‚
â”‚  â”‚  â€¢ PDF Parser    â”‚  â”‚  â€¢ Cache         â”‚  â”‚ â€¢ Email          â”‚          â”‚
â”‚  â”‚  â€¢ Validation    â”‚  â”‚                  â”‚  â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                     â”‚                     â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                           PostgreSQL                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Composants

| Composant | Description |
|-----------|-------------|
| **Interface Admin** | Upload fichiers, visualisation imports, gestion partenaires |
| **API REST** | Endpoints pour recherche et gÃ©nÃ©ration de devis |
| **Module Import** | Parsing des fichiers CSV, Excel, PDF |
| **Module Matching** | Recherche et classement des offres |
| **Module Generator** | GÃ©nÃ©ration PDF et envoi email |
| **PostgreSQL** | Stockage des tarifs et devis |

---

## 3. Modules fonctionnels

### 3.1 Module 1 : Gestion des Partenaires (Socle)

#### Objectif
GÃ©rer le rÃ©fÃ©rentiel des transporteurs et leurs configurations.

#### FonctionnalitÃ©s

| ID | FonctionnalitÃ© | Description |
|----|----------------|-------------|
| F1.1 | CrÃ©ation Partenaire | Ajout d'un transporteur (Nom, Code, Contact) |
| F1.2 | Configuration | DÃ©finition des rÃ¨gles d'import (Yaml) |
| F1.3 | Activation | Activer/DÃ©sactiver un partenaire globalement |
| F1.4 | Suppression Tarifs | Supprimer tous les tarifs d'un partenaire |

### 3.2 Module 2 : Import des tarifs

#### Objectif
Importer les fichiers tarifs des partenaires et les stocker en base.

#### Formats supportÃ©s

| Format | Parsing | FiabilitÃ© |
|--------|---------|-----------|
| **CSV** | pandas | 100% |
| **Excel** (.xlsx, .xls) | pandas + openpyxl | 100% |
| **PDF** (texte) | pdfplumber | 80% |
| **PDF** (complexe) | IA Claude | 95% |

#### FonctionnalitÃ©s

| ID | FonctionnalitÃ© | Description |
|----|----------------|-------------|
| F1.1 | Upload fichier | RÃ©ception CSV, Excel ou PDF |
| F1.2 | DÃ©tection format | Auto-dÃ©tection du type de fichier |
| F1.3 | Mapping colonnes | Correspondance automatique des colonnes |
| F1.4 | Validation | VÃ©rification des donnÃ©es obligatoires |
| F1.5 | Rapport d'import | Liste des succÃ¨s et erreurs |

#### Flux d'import

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Upload    â”‚â”€â”€â”€â”€>â”‚   Parser    â”‚â”€â”€â”€â”€>â”‚  Validator  â”‚â”€â”€â”€â”€>â”‚   Insert    â”‚
â”‚   Fichier   â”‚     â”‚ CSV/XLS/PDF â”‚     â”‚             â”‚     â”‚     BD      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               v
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   Rapport   â”‚
                                        â”‚  d'erreurs  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Module 3 : Recherche (Matching)

#### Objectif
Trouver les meilleures offres pour un trajet donnÃ©.

#### FonctionnalitÃ©s

| ID | FonctionnalitÃ© | Description | Statut |
|----|----------------|-------------|--------|
| F3.1 | Recherche | Filtrer par origine, destination, poids | âœ… |
| F3.2 | Tri | Par prix, dÃ©lai ou score combinÃ© | â³ |
| F3.3 | Limite | Retourner les N meilleures offres | âœ… |
| F3.4 | AutocomplÃ©tion villes | Suggestions de villes basÃ©es sur les tarifs existants | âœ… |
| F3.5 | Validation flexible | Code postal OU ville requis (pas les deux obligatoires) | âœ… |

#### AutocomplÃ©tion des villes (F3.4) âœ… ImplÃ©mentÃ©

**Objectif** : Permettre Ã  l'utilisateur de rechercher une ville parmi celles disponibles dans la base de tarifs.

**Source des donnÃ©es** : Les villes sont extraites des champs `origin_city` et `dest_city` de la table `PartnerQuote`.

**Algorithme de recherche** :
1. Recherche insensible Ã  la casse
2. Recherche par prÃ©fixe (commence par) ou contient
3. DÃ©doublonnage des villes identiques
4. Comptage du nombre de tarifs par ville

**Flux** :
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Input     â”‚â”€â”€â”€â”€>â”‚  Debounce   â”‚â”€â”€â”€â”€>â”‚    API      â”‚â”€â”€â”€â”€>â”‚  Dropdown   â”‚
â”‚  (2+ chars) â”‚     â”‚   (300ms)   â”‚     â”‚ /cities/    â”‚     â”‚ Suggestions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Module 4 : GÃ©nÃ©ration de devis

#### Objectif
CrÃ©er et envoyer des devis PDF aux clients.

#### FonctionnalitÃ©s

| ID | FonctionnalitÃ© | Description |
|----|----------------|-------------|
| F4.1 | Ã‰dition Prix | Ajustement marge et prix de vente (Flexible) |
| F4.2 | Frais annexes | Ajout de lignes manuelles (Assurance, Dossier) |
| F4.3 | GÃ©nÃ©ration PDF | CrÃ©er un devis formatÃ© (Prix de vente uniquement) |
| F4.4 | Envoi email | Transmettre au client |
| F4.5 | Archivage | Stocker le devis |

---

## 4. Interfaces Utilisateur

Cette section dÃ©crit les Ã©crans disponibles dans l'application React.

### 4.1 Espace Administrateur

#### Gestion des Partenaires
*   **Liste des partenaires** : Tableau affichant ID, Nom, Code, Statut (Actif/Inactif). Actions : Modifier, Supprimer.
*   **Fiche Partenaire** : Formulaire pour crÃ©er/Ã©diter un partenaire et ses configurations (YAML).

#### Gestion des Imports
*   **Nouvel Import** : Formulaire d'upload (SÃ©lection Partenaire + Drag & Drop fichier).
*   **Historique** : Tableau des jobs d'import passÃ©s avec statut (SuccÃ¨s/Erreur) et statistiques.
*   **DÃ©tail Import** : Vue des lignes en erreur pour correction (si supportÃ©) ou analyse.

### 4.2 Espace OpÃ©rateur / Client (Simulation)

#### Recherche de Transport (Wizard)
*   **Ã‰tape 1 - ItinÃ©raire** :
    - Pays dÃ©part/arrivÃ©e (obligatoire)
    - Code postal OU Ville (au moins un des deux) avec **autocomplÃ©tion**
*   **Ã‰tape 2 - Marchandise** : Saisie des palettes (Dimensions, Poids, Gerbable).
*   **Ã‰tape 3 - Options** : Filtres (Hayon, Express, etc.).

**RÃ¨gle de validation** : L'utilisateur doit saisir soit un code postal, soit une ville (ou les deux) pour l'origine et la destination.

#### AutocomplÃ©tion des villes âœ… ImplÃ©mentÃ©

L'autocomplÃ©tion permet Ã  l'utilisateur de rechercher rapidement une ville parmi celles disponibles dans la base de tarifs.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ville d'origine                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Par_                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ Paris (FR)                                    125 tarifs  â”‚  â”‚
â”‚  â”‚  ğŸ“ Paray-le-Monial (FR)                           12 tarifs  â”‚  â”‚
â”‚  â”‚  ğŸ“ Parthenay (FR)                                  8 tarifs  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CaractÃ©ristiques :**
- Recherche dÃ¨s 2 caractÃ¨res saisis
- Affiche ville + pays + nombre de tarifs disponibles
- Suggestions basÃ©es sur les villes prÃ©sentes dans les tarifs importÃ©s
- DÃ©lai de debounce (300ms) pour Ã©viter les requÃªtes excessives
- **Navigation clavier** : flÃ¨ches haut/bas pour naviguer, Enter pour sÃ©lectionner, Escape pour fermer

**Navigation clavier :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ville d'origine                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Par_                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ Paris (FR)                                    125 tarifs  â”‚â—€â”€â”€â”€ â†‘â†“ Navigation
â”‚  â”‚  â–¶ Paray-le-Monial (FR)                           12 tarifs  â”‚â—€â”€â”€â”€ Ã‰lÃ©ment actif (surlignÃ©)
â”‚  â”‚  ğŸ“ Parthenay (FR)                                  8 tarifs  â”‚     Enter = SÃ©lectionner
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     Esc = Fermer
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Touche | Action |
|--------|--------|
| `â†“` (ArrowDown) | SÃ©lectionne l'Ã©lÃ©ment suivant |
| `â†‘` (ArrowUp) | SÃ©lectionne l'Ã©lÃ©ment prÃ©cÃ©dent |
| `Enter` | Valide la sÃ©lection et ferme le dropdown |
| `Tab` | Valide la sÃ©lection et passe au champ suivant |
| `Escape` | Ferme le dropdown sans sÃ©lectionner |

#### SÃ©lection & Devis
*   **RÃ©sultats de recherche** : Liste des offres correspondantes (triÃ©es par prix).
*   **GÃ©nÃ©ration de devis** : Formulaire pour saisir les infos client et gÃ©nÃ©rer le PDF final.

### 4.3 Espace Devis Clients (Workflow Panier) âœ… ImplÃ©mentÃ©

Cette section dÃ©crit le workflow "Panier" permettant de construire un devis progressivement en ajoutant plusieurs trajets.

#### 4.3.1 Liste des Devis (`CustomerQuotes.tsx`)

**Structure actuelle :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Devis Clients                                         [+ Nouveau Devis]    â”‚
â”‚  GÃ©rez vos propositions commerciales                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ” Rechercher par rÃ©fÃ©rence, client...                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ RÃ©fÃ©rence    â”‚ Client           â”‚ Date     â”‚ Montant HT â”‚ Statut â”‚    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ DEV-2026-001 â”‚ SociÃ©tÃ© ABC      â”‚ ğŸ“… 27/01 â”‚  450.00 â‚¬  â”‚ DRAFT  â”‚ğŸ‘ğŸ—‘â”‚ â”‚
â”‚  â”‚              â”‚ SARL ABC         â”‚          â”‚            â”‚ (gris) â”‚    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ DEV-2026-002 â”‚ Transport Martin â”‚ ğŸ“… 25/01 â”‚  820.00 â‚¬  â”‚ SENT   â”‚ ğŸ‘ â”‚ â”‚
â”‚  â”‚              â”‚ SAS Martin       â”‚          â”‚            â”‚ (jaune)â”‚    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ DEV-2026-003 â”‚ Logistique Plus  â”‚ ğŸ“… 20/01 â”‚ 1250.00 â‚¬  â”‚ACCEPTEDâ”‚ ğŸ‘ â”‚ â”‚
â”‚  â”‚              â”‚                  â”‚          â”‚            â”‚ (vert) â”‚    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Ã‰tat vide :                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          ğŸ“„                                         â”‚   â”‚
â”‚  â”‚                     Aucun devis                                     â”‚   â”‚
â”‚  â”‚    Commencez par crÃ©er une nouvelle recherche pour gÃ©nÃ©rer un devis â”‚   â”‚
â”‚  â”‚                  Aller Ã  la recherche â†’                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Colonnes du tableau :**
| Colonne | Source | Description |
|---------|--------|-------------|
| RÃ©fÃ©rence | `quote.reference` | DEV-YYYY-XXXX ou "Brouillon" |
| Client | `quote.customer_name` + `quote.customer_company` | Nom et sociÃ©tÃ© |
| Date | `quote.created_at` | Date de crÃ©ation |
| Montant HT | `quote.total` | Total en euros |
| Statut | `quote.status` | Badge colorÃ© |
| Actions | - | IcÃ´nes d'action |

**Statuts et couleurs :**
| Statut | Couleur | Description |
|--------|---------|-------------|
| `DRAFT` | Gris | Brouillon en cours |
| `READY` | Bleu | PrÃªt Ã  envoyer |
| `SENT` | Jaune | EnvoyÃ© au client |
| `ACCEPTED` | Vert | AcceptÃ© |
| `REJECTED` | Rouge | RefusÃ© |

**Actions disponibles :**
| Action | IcÃ´ne | Condition | Description |
|--------|-------|-----------|-------------|
| `+ Nouveau Devis` | - | Toujours | CrÃ©e un devis et redirige vers l'Ã©diteur |
| Voir le devis | ğŸ‘ | Toujours | Navigue vers `/customer-quotes/{id}` |
| Supprimer | ğŸ—‘ | Statut = `DRAFT` | Supprime le devis brouillon |
| Recherche | ğŸ” | Toujours | Filtre par rÃ©fÃ©rence ou client (placeholder) |

#### 4.3.2 Affichage d'un Devis (`CustomerQuoteDetail.tsx`)

**Structure actuelle :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Retour Ã  la liste                                                        â”‚
â”‚                                                                             â”‚
â”‚  DEV-2026-0042                                    â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                                   â”‚ DRAFTâ”‚                  â”‚
â”‚                                                   â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                    [ğŸ–¨ Imprimer] [ğŸ“¤ Envoyer] [âœï¸ Ã‰diter]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“„ DÃ©tail des prestations      3 lignes    â”‚  â”‚  CLIENT               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”Œâ”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚                                             â”‚  â”‚  â”‚ S â”‚ SociÃ©tÃ© ABC    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  â”‚  â””â”€â”€â”€â”˜ SARL           â”‚ â”‚
â”‚  â”‚  â”‚TRANSPORTâ”‚ Paris â†’ Lyon                   â”‚  â”‚                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚  â”‚  Email: contact@abc.frâ”‚ â”‚
â”‚  â”‚  ğŸšš ROAD - DHL Express                      â”‚  â”‚  ValiditÃ©: 28/02/2026 â”‚ â”‚
â”‚  â”‚  Paris, FR â†’ Lyon, FR                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  Poids: 500 kg | DÃ©lai: 24h                 â”‚                            â”‚
â”‚  â”‚                              172.50 â‚¬       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Marge: 15% (22.50 â‚¬)     â”‚  â”‚  RÃ‰CAPITULATIF        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                       â”‚ â”‚
â”‚  â”‚                                             â”‚  â”‚  Total Transport      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  â”‚            304.50 â‚¬   â”‚ â”‚
â”‚  â”‚  â”‚TRANSPORTâ”‚ Lyon â†’ Marseille               â”‚  â”‚  Total Frais          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚  â”‚             25.00 â‚¬   â”‚ â”‚
â”‚  â”‚  ğŸšš ROAD - Transport Besson                 â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚  Lyon, FR â†’ Marseille, FR                   â”‚  â”‚  Total HT             â”‚ â”‚
â”‚  â”‚  Poids: 500 kg | DÃ©lai: 48h                 â”‚  â”‚            329.50 â‚¬   â”‚ â”‚
â”‚  â”‚                              132.00 â‚¬       â”‚  â”‚                       â”‚ â”‚
â”‚  â”‚                    Marge: 10% (12.00 â‚¬)     â”‚  â”‚  Marge Totale         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚             34.50 â‚¬   â”‚ â”‚
â”‚  â”‚                                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”                                    â”‚                            â”‚
â”‚  â”‚  â”‚FRAISâ”‚ Frais de dossier                   â”‚                            â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜                                    â”‚                            â”‚
â”‚  â”‚                               25.00 â‚¬       â”‚                            â”‚
â”‚  â”‚                    Marge: 100% (25.00 â‚¬)    â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Layout :** Grille 3 colonnes (2/3 contenu principal + 1/3 sidebar)

**Zone principale - DÃ©tail des prestations :**
| Ã‰lÃ©ment | Description |
|---------|-------------|
| Badge type | `TRANSPORT` (bleu) ou `FRAIS` (orange) |
| Description | `item.description` |
| DÃ©tails transport | Mode, partenaire, origine â†’ destination, poids, dÃ©lai |
| Prix vente | `item.sell_price` |
| Marge | Pourcentage et montant |

**Sidebar - Informations :**
| Section | Contenu |
|---------|---------|
| Client | Avatar, nom, sociÃ©tÃ©, email, validitÃ© |
| RÃ©capitulatif | Total transport, total frais, total HT, marge totale |

**Actions disponibles :**
| Bouton | Action |
|--------|--------|
| Imprimer | Placeholder (non implÃ©mentÃ©) |
| Envoyer | Placeholder (non implÃ©mentÃ©) |
| Ã‰diter | Navigation vers `/customer-quotes/{id}/edit` |

#### 4.3.3 Ã‰dition d'un Devis (`CustomerQuoteEditor.tsx`)

**Structure actuelle :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† â”‚ Ã‰diteur de Devis | DEV-2026-0042                                       â”‚
â”‚      Sans client - DRAFT                                                    â”‚
â”‚                                          Marge Totale â”‚ Total HT            â”‚
â”‚                                             34.50 â‚¬   â”‚ 329.50 â‚¬            â”‚
â”‚                                                       â”‚        [Enregistrer]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ‘¤ Informations Client                                        [âœï¸ Modifier]â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nom : SociÃ©tÃ© ABC                                                  â”‚   â”‚
â”‚  â”‚  SociÃ©tÃ© : SARL ABC                                                 â”‚   â”‚
â”‚  â”‚  Email : contact@abc.fr                                             â”‚   â”‚
â”‚  â”‚  ValiditÃ© : 28/02/2026                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š Prestations Transport                          Sous-total: 304.50 â‚¬     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Paris â†’ Lyon                                                       â”‚   â”‚
â”‚  â”‚  DHL Express | ROAD | 24h | 500 kg                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Prix Achat    Marge %      Marge â‚¬      Prix Vente                 â”‚   â”‚
â”‚  â”‚  150.00 â‚¬      [15   ]%     22.50 â‚¬      172.50 â‚¬              [ğŸ—‘] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Lyon â†’ Marseille                                                   â”‚   â”‚
â”‚  â”‚  Transport Besson | ROAD | 48h | 500 kg                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Prix Achat    Marge %      Marge â‚¬      Prix Vente                 â”‚   â”‚
â”‚  â”‚  120.00 â‚¬      [10   ]%     12.00 â‚¬      132.00 â‚¬              [ğŸ—‘] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Mode de transport : [ğŸšš Route â–¼] [ğŸš‚ Rail] [âœˆï¸ AÃ©rien] [ğŸš¢ Maritime] â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                    [+ Ajouter un transport]                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  (Visible uniquement si statut = DRAFT)                                    â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                             â”‚
â”‚  â• Frais Annexes                                   [+ Ajouter un coÃ»t]     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Frais de dossier                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Prix Vente                                                         â”‚   â”‚
â”‚  â”‚  [25.00  ] â‚¬                                                   [ğŸ—‘] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  (Si aucun transport: "Aucune ligne de transport. Ajoutez des tarifs        â”‚
â”‚   depuis la recherche." + lien vers /search)                                â”‚
â”‚  (Si aucun frais: "Aucun frais additionnel.")                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Modal Ã‰dition Client :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modifier les informations client                [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Nom *                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SociÃ©tÃ© ABC                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  SociÃ©tÃ©                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SARL ABC                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Email                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ contact@abc.fr                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Date de validitÃ©                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 28/02/2026                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Annuler     â”‚  â”‚  Enregistrer  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Barre supÃ©rieure :**
| Ã‰lÃ©ment | Description |
|---------|-------------|
| Retour | Lien vers `/customer-quotes/{id}` |
| Titre | "Ã‰diteur de Devis \| {reference}" |
| Sous-titre | Client et statut |
| Marge Totale | Affichage en temps rÃ©el |
| Total HT | Affichage en temps rÃ©el |
| Enregistrer | Bouton de sauvegarde |

**Section Client :**
| Champ | Ã‰ditable | Description |
|-------|----------|-------------|
| Nom | **Oui** | `customer_name` - Nom du contact |
| SociÃ©tÃ© | **Oui** | `customer_company` - Raison sociale |
| Email | **Oui** | `customer_email` - Email de contact |
| ValiditÃ© | **Oui** | `valid_until` - Date de validitÃ© du devis |

**SÃ©lecteur Mode de Transport :**
| Mode | IcÃ´ne | Valeur |
|------|-------|--------|
| Route | ğŸšš | `ROAD` |
| Rail | ğŸš‚ | `RAIL` |
| AÃ©rien | âœˆï¸ | `AIR` |
| Maritime | ğŸš¢ | `SEA` |

Le mode sÃ©lectionnÃ© est passÃ© Ã  la modal de recherche lors de l'ajout d'un transport.

**Bouton "+ Ajouter un transport" :**
- Visible uniquement si `status === 'DRAFT'`
- Ouvre la modal de recherche avec le mode de transport prÃ©-sÃ©lectionnÃ©
- Le mode n'est plus modifiable dans la modal

**Section Transport (`QuoteItemEditor`) :**
| Champ | Ã‰ditable | Description |
|-------|----------|-------------|
| Description | Non | Trajet (origine â†’ destination) |
| DÃ©tails | Non | Partenaire, mode, dÃ©lai, poids |
| Prix Achat | Non | `cost_price` (prix partenaire) |
| Marge % | **Oui** | Pourcentage de marge modifiable |
| Marge â‚¬ | CalculÃ© | `cost_price Ã— margin_percent / 100` |
| Prix Vente | CalculÃ© | `cost_price + margin_amount` |
| Supprimer | Oui | Bouton corbeille |

**Section Frais (`QuoteItemEditor`) :**
| Champ | Ã‰ditable | Description |
|-------|----------|-------------|
| Description | Non | LibellÃ© du frais |
| Prix Vente | **Oui** | Montant modifiable directement |
| Supprimer | Oui | Bouton corbeille |

**Modal Ajout de Frais (`AddFeeModal`) :**
- Permet d'ajouter des frais prÃ©dÃ©finis ou personnalisÃ©s
- Champs : description, montant

**Modal Ã‰dition Client (`EditCustomerModal`) :**
- Permet de modifier les informations du client
- Champs : nom, sociÃ©tÃ©, email, date de validitÃ©

#### 4.3.4 Modal Recherche (`SearchModal.tsx`)

**Ã‰volution proposÃ©e :** Transformer la page de recherche en modal pour amÃ©liorer l'ergonomie et permettre de lancer une recherche sans quitter le contexte actuel.

**Note importante :** Le mode de transport est sÃ©lectionnÃ© dans l'Ã©diteur de devis (section 4.3.3) et passÃ© Ã  la modal. Il n'est plus modifiable dans la modal.

**Structure cible :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  Rechercher un transport                                     [X]  â”‚     â”‚
â”‚   â”‚  Mode : ğŸšš Route                                                  â”‚     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚   â”‚  â”‚  ğŸ“ Origine             â”‚  â”‚  ğŸ“ Destination         â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â”‚Franceâ–¼â”‚ â”‚ 75001    â”‚ â”‚  â”‚  â”‚Franceâ–¼â”‚ â”‚ 69002    â”‚ â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â”‚ Paris              â”‚ â”‚  â”‚  â”‚ Lyon               â”‚ â”‚        â”‚     â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚
â”‚   â”‚  â”‚ğŸ“¦ Marchandise            â”‚  â”‚ğŸ“… Date                   â”‚      â”‚     â”‚
â”‚   â”‚  â”‚                          â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ Poids (kg) *             â”‚  â”‚ Date d'expÃ©dition *      â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â”‚ 500                  â”‚ â”‚  â”‚ â”‚ 27/01/2026           â”‚ â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚     â”‚
â”‚   â”‚  â”‚                          â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ Volume (m3)              â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â”‚ 2.5                  â”‚ â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                          â”‚      â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚   Annuler     â”‚  â”‚         ğŸ” Rechercher les offres        â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚  (ArriÃ¨re-plan : page des rÃ©sultats ou devis en cours visible)              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Points d'accÃ¨s Ã  la modal :**
| Emplacement | Action | Mode transport |
|-------------|--------|----------------|
| Header/Navbar | Bouton "ğŸ” Rechercher" | Aucun (tous modes) |
| Ã‰diteur Devis | Bouton "+ Ajouter un transport" | Mode sÃ©lectionnÃ© dans l'Ã©diteur |
| Page RÃ©sultats | Bouton "Nouvelle recherche" | Mode prÃ©cÃ©dent conservÃ© |

**Champs disponibles :**
| Champ | Type | Obligatoire | Description |
|-------|------|-------------|-------------|
| `origin_country` | Select | Oui | FR, DE, IT, ES, BE |
| `origin_postal_code` | Text | Non* | Code postal origine |
| `origin_city` | Autocomplete | Non* | Ville origine |
| `dest_country` | Select | Oui | FR, DE, IT, ES, BE |
| `dest_postal_code` | Text | Non* | Code postal destination |
| `dest_city` | Autocomplete | Non* | Ville destination |
| `weight` | Number | Oui | Poids en kg |
| `volume` | Number | Non | Volume en mÂ³ |
| `shipping_date` | Date | Oui | Date d'expÃ©dition |

*Au moins ville OU code postal requis pour origine et destination.

**ParamÃ¨tre passÃ© (non modifiable) :**
| ParamÃ¨tre | Source | Description |
|-----------|--------|-------------|
| `transport_mode` | Ã‰diteur de devis | ROAD, RAIL, AIR, SEA ou undefined (tous) |

**Comportement :**
| Action | RÃ©sultat |
|--------|----------|
| Clic "Rechercher" | Ferme la modal, navigue vers `/results` avec les rÃ©sultats |
| Clic "Annuler" ou "X" | Ferme la modal, reste sur la page actuelle |
| Clic hors modal | Ferme la modal |
| Touche Escape | Ferme la modal |

#### 4.3.5 Page RÃ©sultats (`Results.tsx`)

**Structure actuelle :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Retour Ã  la recherche                                                    â”‚
â”‚                                                                             â”‚
â”‚  3 offre(s) correspondante(s)                                               â”‚
â”‚  ğŸ“ Paris, 75001, France â†’ ğŸ“ Lyon, 69002, France | ğŸ“¦ 500 kg               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”                                                             â”‚   â”‚
â”‚  â”‚  â”‚ ğŸšš â”‚  DHL Express                                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚          â”‚ ROAD â”‚ â”‚ 100 - 1000 kg  â”‚                                â”‚   â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ğŸ“ dest: Lyon     ğŸ• transit: 24h     ğŸ“… validitÃ©: 2026-03-01      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                                    Prix estimÃ©                      â”‚   â”‚
â”‚  â”‚                                    150.00 EUR   [â• Ajouter au devis]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”                                                             â”‚   â”‚
â”‚  â”‚  â”‚ ğŸšš â”‚  Transport Besson                                           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚          â”‚ ROAD â”‚ â”‚ 200 - 2000 kg  â”‚                                â”‚   â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ğŸ“ dest: Dept 69  ğŸ• transit: 48h     ğŸ“… validitÃ©: illimitÃ©e       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                                    Prix estimÃ©                      â”‚   â”‚
â”‚  â”‚                                    120.00 EUR   [â• Ajouter au devis]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”                                                             â”‚   â”‚
â”‚  â”‚  â”‚ ğŸšš â”‚  XPO Logistics                                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚          â”‚ ROAD â”‚ â”‚ 50 - 800 kg    â”‚                                â”‚   â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ğŸ“ dest: Lyon     ğŸ• transit: 36h     ğŸ“… validitÃ©: 2026-02-15      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                                    Prix estimÃ©                      â”‚   â”‚
â”‚  â”‚                                    135.00 EUR   [â• Ajouter au devis]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Informations affichÃ©es par rÃ©sultat :**
| Ã‰lÃ©ment | Source | Description |
|---------|--------|-------------|
| Nom partenaire | `quote.partner.name` | Nom du transporteur |
| Mode transport | `quote.transport_mode` | ROAD, RAIL, AIR, SEA |
| Plage poids | `quote.weight_min` - `quote.weight_max` | CapacitÃ© en kg |
| DÃ©lai transit | `quote.delivery_time` | DurÃ©e de livraison |
| Ville destination | `quote.dest_city` | Ville de destination (si spÃ©cifique) |
| ValiditÃ© | `quote.valid_until` | Date limite de validitÃ© |
| Prix | `quote.cost` + `quote.currency` | Prix estimÃ© |

**Action disponible :** Bouton "Ajouter au devis" â†’ appelle `addItem(quote.id, criteria.weight)`

#### 4.3.6 Sidebar Devis en Cours (`QuoteSidebar.tsx`)

**Structure actuelle :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›’ Mon Devis en cours              [X]â”‚  â† Header bleu foncÃ©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚ â”‚TRANSPORT â”‚  500 kg         [ğŸ—‘]â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚ Paris â†’ Lyon                     â”‚  â”‚
â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚ DHL Express                      â”‚  â”‚
â”‚  â”‚              172.50 â‚¬            â”‚  â”‚
â”‚  â”‚              Marge: 15% (22.50 â‚¬)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚ â”‚TRANSPORT â”‚  500 kg         [ğŸ—‘]â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚ Lyon â†’ Marseille                 â”‚  â”‚
â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚ Transport Besson                 â”‚  â”‚
â”‚  â”‚              132.00 â‚¬            â”‚  â”‚
â”‚  â”‚              Marge: 10% (12.00 â‚¬)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”                         â”‚  â”‚
â”‚  â”‚ â”‚FRAIS â”‚                     [ğŸ—‘]â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”˜                         â”‚  â”‚
â”‚  â”‚ Frais de dossier                 â”‚  â”‚
â”‚  â”‚                       25.00 â‚¬    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sous-total Transport      304.50 â‚¬    â”‚
â”‚  Frais annexes              25.00 â‚¬    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  Total HT                  329.50 â‚¬    â”‚
â”‚  Marge Totale               34.50 â‚¬    â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Vider    â”‚  â”‚ ğŸ“„ Finaliser   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**FonctionnalitÃ©s actuelles :**
| Action | Fonction | Description |
|--------|----------|-------------|
| Fermer | `closeSidebar()` | Ferme le panel latÃ©ral |
| Supprimer item | `removeItem(item.id)` | Retire une ligne du devis |
| Vider | `clearQuote()` | Supprime tout le devis |
| Finaliser | Navigation vers `/customer-quotes/{id}/edit` | Ouvre l'Ã©diteur de prix |

---

## 5. Cas d'usage

### 4.1 UC01 : Importer les tarifs d'un partenaire

```
Acteur: Administrateur
PrÃ©condition: Admin authentifiÃ©, fichier tarifs reÃ§u du partenaire

ScÃ©nario principal:
1. L'admin accÃ¨de Ã  l'interface d'import
2. L'admin sÃ©lectionne le partenaire concernÃ©
3. L'admin uploade le fichier (CSV, Excel ou PDF)
4. Le systÃ¨me dÃ©tecte le format et parse le fichier
5. Le systÃ¨me affiche un aperÃ§u avec le mapping des colonnes
6. L'admin valide le mapping (ou l'ajuste si nÃ©cessaire)
7. Le systÃ¨me valide et importe les tarifs
8. Le systÃ¨me affiche le rapport d'import (X succÃ¨s, Y erreurs)

Extensions:
5a. Mapping incorrect dÃ©tectÃ©:
    5a1. L'admin corrige manuellement le mapping
    5a2. Retour Ã©tape 6

7a. Erreurs de validation:
    7a1. Le systÃ¨me liste les lignes en erreur
    7a2. L'admin peut tÃ©lÃ©charger le rapport d'erreurs
    7a3. Les lignes valides sont importÃ©es

Postcondition: Tarifs importÃ©s et disponibles pour recherche
```

### 4.2 UC02 : Rechercher des offres

```
Acteur: Client (via API ou interface)
PrÃ©condition: Aucune

ScÃ©nario principal:
1. Le client saisit son besoin:
   - Pays d'origine (obligatoire)
   - Code postal OU Ville d'origine (au moins un des deux)
   - Pays de destination (obligatoire)
   - Code postal OU Ville de destination (au moins un des deux)
   - Poids (optionnel)
   - Volume (optionnel)
2. Le systÃ¨me valide que chaque localisation a au moins un identifiant (CP ou ville)
3. Le systÃ¨me recherche les offres correspondantes
4. Le systÃ¨me classe par prix (par dÃ©faut)
5. Le systÃ¨me retourne les meilleures offres

Extensions:
2a. Validation Ã©chouÃ©e (ni CP ni ville):
    2a1. Le systÃ¨me affiche "Veuillez saisir un code postal ou une ville"
    2a2. Retour Ã©tape 1

Postcondition: Liste des offres affichÃ©e
```

### 4.3 UC03 : GÃ©nÃ©rer et envoyer un devis

```
Acteur: Client
PrÃ©condition: Offres affichÃ©es (UC02)

ScÃ©nario principal:
1. Le client sÃ©lectionne une ou plusieurs offres
2. Le client saisit son email
3. Le systÃ¨me gÃ©nÃ¨re le PDF du devis
4. Le systÃ¨me envoie le devis par email
5. Le systÃ¨me confirme l'envoi

Postcondition: Devis envoyÃ© et archivÃ©
```

### 4.4 UC04 : Supprimer tous les tarifs d'un partenaire

```
Acteur: Administrateur
PrÃ©condition: Admin authentifiÃ©, partenaire existant avec des tarifs

ScÃ©nario principal:
1. L'admin accÃ¨de Ã  la page Partenaires
2. L'admin clique sur l'icÃ´ne "Supprimer tarifs" du partenaire concernÃ©
3. Le systÃ¨me affiche une modal de confirmation avec :
   - Le nom du partenaire
   - Le nombre de tarifs Ã  supprimer
   - Un champ de saisie pour le code partenaire
4. L'admin saisit le code du partenaire pour confirmer
5. L'admin clique sur "Supprimer"
6. Le systÃ¨me supprime tous les tarifs du partenaire
7. Le systÃ¨me affiche une notification de succÃ¨s avec le nombre de tarifs supprimÃ©s
8. La liste des partenaires est rafraÃ®chie

Extensions:
3a. Aucun tarif associÃ© au partenaire:
    3a1. Le systÃ¨me affiche un message "Aucun tarif Ã  supprimer"
    3a2. Le bouton "Supprimer" est dÃ©sactivÃ©

4a. Code partenaire incorrect:
    4a1. Le bouton "Supprimer" reste dÃ©sactivÃ©
    4a2. L'admin corrige la saisie

5a. Annulation:
    5a1. L'admin clique sur "Annuler"
    5a2. La modal se ferme, aucune action effectuÃ©e

7a. Erreur lors de la suppression:
    7a1. Le systÃ¨me affiche une notification d'erreur
    7a2. Les tarifs ne sont pas supprimÃ©s

Postcondition: Tarifs du partenaire supprimÃ©s de la base de donnÃ©es
```

### 4.5 UC05 : CrÃ©er un devis multi-trajets (Workflow Panier) âœ… ImplÃ©mentÃ©

```
Acteur: OpÃ©rateur
PrÃ©condition: Tarifs importÃ©s, opÃ©rateur connectÃ©

ScÃ©nario principal:
1. L'opÃ©rateur clique sur "Nouveau Devis" ou ajoute un tarif depuis les rÃ©sultats
   â†’ Un brouillon est crÃ©Ã© automatiquement (DEV-2026-XXXX)
   â†’ La sidebar "Devis en cours" s'ouvre

2. L'opÃ©rateur sÃ©lectionne un mode de transport (Route, Rail, AÃ©rien, Maritime)
3. L'opÃ©rateur clique sur "+ Ajouter un transport"
   â†’ La modal de recherche s'ouvre avec le mode prÃ©-sÃ©lectionnÃ©

4. L'opÃ©rateur saisit les critÃ¨res et lance la recherche
   â†’ Les rÃ©sultats s'affichent

5. L'opÃ©rateur clique sur "Ajouter au devis" pour un tarif
   â†’ Le tarif est ajoutÃ© avec la marge par dÃ©faut du partenaire
   â†’ La sidebar se met Ã  jour avec les totaux

6. L'opÃ©rateur rÃ©pÃ¨te les Ã©tapes 2-5 pour ajouter d'autres trajets

7. L'opÃ©rateur clique sur "Finaliser" dans la sidebar
   â†’ L'Ã©diteur de devis s'ouvre

8. L'opÃ©rateur ajuste les marges si nÃ©cessaire
   â†’ Les prix de vente sont recalculÃ©s automatiquement

9. L'opÃ©rateur ajoute des frais (dossier, assurance...)
   â†’ Modal de saisie des frais

10. L'opÃ©rateur renseigne les informations client
    â†’ Modal d'Ã©dition client (nom, sociÃ©tÃ©, email, validitÃ©)

11. L'opÃ©rateur enregistre le devis
    â†’ Le devis passe en statut READY

Extensions:
1a. Ajout direct depuis les rÃ©sultats sans devis en cours:
    1a1. Le systÃ¨me crÃ©e automatiquement un brouillon
    1a2. Le tarif est ajoutÃ© au nouveau devis
    1a3. La sidebar s'ouvre

5a. Tarif dÃ©jÃ  dans le devis:
    5a1. Le bouton affiche "Retirer du devis"
    5a2. L'opÃ©rateur peut retirer le tarif

8a. Modification du prix de vente directement:
    8a1. L'opÃ©rateur saisit le prix de vente
    8a2. La marge est recalculÃ©e automatiquement

Postcondition: Devis crÃ©Ã© avec plusieurs trajets, prÃªt Ã  envoyer
```

### 4.6 UC06 : Supprimer un devis brouillon

```
Acteur: OpÃ©rateur
PrÃ©condition: Devis existant avec statut DRAFT

ScÃ©nario principal:
1. L'opÃ©rateur accÃ¨de Ã  la liste des devis
2. L'opÃ©rateur clique sur l'icÃ´ne poubelle (ğŸ—‘) d'un devis DRAFT
3. Le systÃ¨me demande confirmation
4. L'opÃ©rateur confirme la suppression
5. Le devis est supprimÃ©
6. La liste est rafraÃ®chie

Extensions:
2a. Le devis n'est pas en DRAFT:
    2a1. L'icÃ´ne poubelle n'est pas visible
    2a2. Seule l'icÃ´ne Å“il (ğŸ‘) est disponible

Postcondition: Devis supprimÃ© de la base de donnÃ©es
```

---

## 5. Flux de donnÃ©es

### 5.1 Format fichier d'entrÃ©e (attendu)

Le systÃ¨me accepte les colonnes suivantes (noms flexibles) :

| Champ systÃ¨me | Variantes acceptÃ©es | Obligatoire |
|---------------|---------------------|-------------|
| `transport_mode` | mode, type_transport, mode_transport | âœ“ |
| `origin_city` | ville_origine, depart, from_city | âœ“ |
| `origin_country` | pays_origine, from_country | âœ“ |
| `destination_city` | ville_destination, arrivee, to_city | âœ“ |
| `destination_country` | pays_destination, to_country | âœ“ |
| `cost` | prix, tarif, price, montant | âœ“ |
| `weight_min` | poids_min, min_weight | - |
| `weight_max` | poids_max, max_weight | - |
| `delivery_time` | delai, transit_time, temps_livraison | - |
| `valid_until` | validite, expiration, date_fin | - |

### 5.2 Exemple CSV

```csv
mode_transport,ville_origine,pays_origine,ville_destination,pays_destination,poids_max,prix,delai
road,Paris,FR,Brussels,BE,1000,120.50,48h
road,Paris,FR,Amsterdam,NL,1000,180.00,72h
rail,Lyon,FR,Milan,IT,5000,350.00,96h
sea,Marseille,FR,Shanghai,CN,20000,2500.00,30d
air,Paris,FR,New York,US,500,850.00,24h
```

### 5.3 Exemple Excel

| Mode | Origine | Pays | Destination | Pays | Poids max (kg) | Prix (â‚¬) | DÃ©lai |
|------|---------|------|-------------|------|----------------|----------|-------|
| road | Paris | FR | Brussels | BE | 1000 | 120.50 | 48h |
| road | Paris | FR | Amsterdam | NL | 1000 | 180.00 | 72h |
| rail | Lyon | FR | Milan | IT | 5000 | 350.00 | 96h |

### 5.4 DonnÃ©es normalisÃ©es (sortie)

```json
{
  "partner_id": "uuid",
  "transport_mode": "ROAD",
  "origin_city": "Paris",
  "origin_country": "FR",
  "destination_city": "Brussels",
  "destination_country": "BE",
  "weight_max": 1000,
  "cost": 120.50,
  "currency": "EUR",
  "delivery_time": "48h",
  "is_active": true
}
```

---

## 6. ModÃ¨le de donnÃ©es

### 6.1 SchÃ©ma simplifiÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Partner      â”‚       â”‚  PartnerQuote   â”‚       â”‚ GeneratedQuote  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          PK  â”‚â”€â”€â”€â”   â”‚ id          PK  â”‚       â”‚ id          PK  â”‚
â”‚ name            â”‚   â”‚   â”‚ partner_id  FK  â”‚<â”€â”€â”€â”€â”€â”€â”‚ quote_number    â”‚
â”‚ code            â”‚   â”‚   â”‚ transport_mode  â”‚       â”‚ customer_email  â”‚
â”‚ is_active       â”‚   â””â”€â”€>â”‚ origin_city     â”‚       â”‚ items (JSON)    â”‚
â”‚ created_at      â”‚       â”‚ origin_country  â”‚       â”‚ total_amount    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ dest_city       â”‚       â”‚ pdf_url         â”‚
                          â”‚ dest_country    â”‚       â”‚ status          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ weight_min      â”‚       â”‚ sent_at         â”‚
â”‚   ImportJob     â”‚       â”‚ weight_max      â”‚       â”‚ created_at      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚ cost            â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ id          PK  â”‚       â”‚ currency        â”‚
â”‚ partner_id  FK  â”‚       â”‚ delivery_time   â”‚
â”‚ filename        â”‚       â”‚ valid_until     â”‚
â”‚ status          â”‚       â”‚ is_active       â”‚
â”‚ total_rows      â”‚       â”‚ created_at      â”‚
â”‚ success_count   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ error_count     â”‚                â”‚
â”‚ errors (JSON)   â”‚                â”‚
â”‚ created_at      â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEVIS CLIENTS (Workflow Panier)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  CustomerQuote  â”‚       â”‚  CustomerQuoteItem    â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ id          PK  â”‚â”€â”€â”€â”€â”€â”€>â”‚ id               PK   â”‚                â”‚
â”‚  â”‚ reference       â”‚       â”‚ quote_id         FK   â”‚                â”‚
â”‚  â”‚ status          â”‚       â”‚ item_type             â”‚                â”‚
â”‚  â”‚ customer_name   â”‚       â”‚ description           â”‚                â”‚
â”‚  â”‚ customer_email  â”‚       â”‚ partner_quote_id FKâ”€â”€â”€â”¼â”€â”€ (vers PartnerQuote)
â”‚  â”‚ customer_companyâ”‚       â”‚ origin_city (snap)    â”‚                â”‚
â”‚  â”‚ transport_subtotâ”‚       â”‚ dest_city (snap)      â”‚                â”‚
â”‚  â”‚ fees_total      â”‚       â”‚ partner_name (snap)   â”‚                â”‚
â”‚  â”‚ total           â”‚       â”‚ cost_price            â”‚                â”‚
â”‚  â”‚ total_margin    â”‚       â”‚ sell_price            â”‚                â”‚
â”‚  â”‚ valid_until     â”‚       â”‚ margin_percent        â”‚                â”‚
â”‚  â”‚ created_at      â”‚       â”‚ margin_amount         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ModÃ¨les SQLAlchemy

```python
# app/models/partner.py

class Partner(Base):
    __tablename__ = "partners"

    id = Column(String, primary_key=True, default=uuid4)
    name = Column(String, nullable=False)
    code = Column(String, unique=True, nullable=False)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)

    quotes = relationship("PartnerQuote", back_populates="partner")
    import_jobs = relationship("ImportJob", back_populates="partner")


class TransportMode(str, Enum):
    ROAD = "ROAD"
    RAIL = "RAIL"
    SEA = "SEA"
    AIR = "AIR"
    MULTIMODAL = "MULTIMODAL"


class PartnerQuote(Base):
    __tablename__ = "partner_quotes"

    id = Column(String, primary_key=True)
    partner_id = Column(String, ForeignKey("partners.id"))
    transport_mode = Column(Enum(TransportMode))
    origin_city = Column(String)
    origin_country = Column(String)
    dest_city = Column(String)
    dest_country = Column(String)
    weight_min = Column(Float, nullable=True)
    weight_max = Column(Float, nullable=True)
    cost = Column(Numeric(10, 2))  # Prix Achat Partenaire
    currency = Column(String, default="EUR")
    delivery_time = Column(String, nullable=True)
    valid_until = Column(DateTime, nullable=True)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)

class QuoteItem(Base):
    """ dÃ©tail d'une ligne de devis gÃ©nÃ©rÃ© """
    __tablename__ = "quote_items"

    id = Column(String, primary_key=True)
    generated_quote_id = Column(String, ForeignKey("generated_quotes.id"))
    description = Column(String)      # ex: "Transport Paris->Lyon"
    cost_price = Column(Numeric(10, 2)) # Prix Achat
    sell_price = Column(Numeric(10, 2)) # Prix Vente (Client)
    margin_amount = Column(Numeric(10, 2)) # Marge
    item_type = Column(String) # "TRANSPORT" ou "FEE"


# ============ DEVIS CLIENTS (Workflow Panier) ============

class CustomerQuoteStatus(str, Enum):
    DRAFT = "DRAFT"         # En cours de construction
    READY = "READY"         # PrÃªt Ã  envoyer
    SENT = "SENT"           # EnvoyÃ© au client
    ACCEPTED = "ACCEPTED"   # AcceptÃ© par le client
    REJECTED = "REJECTED"   # RefusÃ©


class CustomerQuote(Base):
    """Devis client (cycle complet : brouillon â†’ envoyÃ© â†’ acceptÃ©)"""
    __tablename__ = "customer_quotes"

    id = Column(String, primary_key=True)
    reference = Column(String, unique=True)  # DEV-2026-XXXX
    status = Column(Enum(CustomerQuoteStatus), default=CustomerQuoteStatus.DRAFT)

    # Client (optionnel en brouillon)
    customer_name = Column(String, nullable=True)
    customer_email = Column(String, nullable=True)
    customer_company = Column(String, nullable=True)

    # Totaux (calculÃ©s)
    transport_subtotal = Column(Numeric(10, 2), default=0)
    fees_total = Column(Numeric(10, 2), default=0)
    total = Column(Numeric(10, 2), default=0)
    total_margin = Column(Numeric(10, 2), default=0)
    currency = Column(String, default="EUR")

    # ValiditÃ©
    valid_until = Column(DateTime, nullable=True)

    # MÃ©tadonnÃ©es
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)

    # Relations
    items = relationship("CustomerQuoteItem", back_populates="quote")


class CustomerQuoteItemType(str, Enum):
    TRANSPORT = "TRANSPORT"   # Trajet issu d'un tarif partenaire
    FEE = "FEE"               # Frais ajoutÃ© manuellement


class CustomerQuoteItem(Base):
    """Ligne de devis client (trajet ou frais)"""
    __tablename__ = "customer_quote_items"

    id = Column(String, primary_key=True)
    quote_id = Column(String, ForeignKey("customer_quotes.id"))
    item_type = Column(Enum(CustomerQuoteItemType))

    # Description
    description = Column(String)  # Ex: "Paris â†’ Lyon" ou "Frais de dossier"

    # RÃ©fÃ©rence au tarif source (NULL pour les frais)
    partner_quote_id = Column(String, ForeignKey("partner_quotes.id"), nullable=True)

    # Snapshot des donnÃ©es transport
    origin_city = Column(String, nullable=True)
    origin_country = Column(String, nullable=True)
    dest_city = Column(String, nullable=True)
    dest_country = Column(String, nullable=True)
    partner_name = Column(String, nullable=True)
    transport_mode = Column(String, nullable=True)
    delivery_time = Column(String, nullable=True)
    weight = Column(Float, nullable=True)

    # Prix
    cost_price = Column(Numeric(10, 2), default=0)   # Prix d'achat
    sell_price = Column(Numeric(10, 2))              # Prix de vente
    margin_percent = Column(Numeric(5, 2))           # Marge en %
    margin_amount = Column(Numeric(10, 2))           # Marge en EUR

    created_at = Column(DateTime, default=datetime.utcnow)

    # Relations
    quote = relationship("CustomerQuote", back_populates="items")
```

---

## 7. API Reference

### 7.1 Endpoints

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| `POST` | `/api/v1/imports/upload` | Importer un fichier tarifs |
| `GET` | `/api/v1/imports/{id}` | Statut d'un import |
| `POST` | `/api/v1/partners` | CrÃ©er un partenaire |
| `GET` | `/api/v1/partners` | Liste des partenaires |
| `GET` | `/api/v1/partners/{id}` | DÃ©tails d'un partenaire |
| `PUT` | `/api/v1/partners/{id}` | Modifier un partenaire |
| `DELETE` | `/api/v1/partners/{id}` | Supprimer un partenaire |
| `DELETE` | `/api/v1/partners/{id}/quotes` | Supprimer tous les tarifs d'un partenaire |
| `GET` | `/api/v1/cities/suggest` | AutocomplÃ©tion des villes |
| `POST` | `/api/v1/match` | Rechercher des offres |
| `POST` | `/api/v1/generated-quotes` | GÃ©nÃ©rer un devis |
| `GET` | `/api/v1/generated-quotes/{id}` | DÃ©tail d'un devis |
| | | |
| **Devis Clients** | | |
| `POST` | `/api/v1/customer-quotes` | CrÃ©er un nouveau devis (brouillon) |
| `GET` | `/api/v1/customer-quotes` | Lister les devis |
| `GET` | `/api/v1/customer-quotes/{id}` | DÃ©tail d'un devis |
| `PUT` | `/api/v1/customer-quotes/{id}` | Modifier un devis (client, validitÃ©) |
| `DELETE` | `/api/v1/customer-quotes/{id}` | Supprimer un devis |
| `POST` | `/api/v1/customer-quotes/{id}/items` | Ajouter un transport au devis |
| `PUT` | `/api/v1/customer-quotes/{id}/items/{item_id}` | Modifier une ligne (marge, prix) |
| `DELETE` | `/api/v1/customer-quotes/{id}/items/{item_id}` | Retirer une ligne |
| `POST` | `/api/v1/customer-quotes/{id}/fees` | Ajouter une ligne de frais |

### 7.2 Import de fichier

```bash
POST /api/v1/imports/upload
Content-Type: multipart/form-data

# ParamÃ¨tres
file: <fichier>              # CSV, Excel ou PDF
partner_id: <uuid>           # ID du partenaire
```

**RÃ©ponse (succÃ¨s)**
```json
{
  "id": "uuid",
  "status": "COMPLETED",
  "total_rows": 150,
  "success_count": 147,
  "error_count": 3,
  "errors": [
    {
      "row": 45,
      "field": "cost",
      "message": "Le prix doit Ãªtre positif",
      "value": "-50"
    }
  ]
}
```

### 7.3 Recherche d'offres

#### Description

Recherche des tarifs correspondant aux critÃ¨res de transport.
**RÃ¨gle de validation** : Pour l'origine et la destination, il faut saisir **soit un code postal, soit une ville** (ou les deux).

#### ParamÃ¨tres

| ParamÃ¨tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| `origin_country` | string | Oui | Code pays ISO (ex: FR, BE) |
| `origin_postal_code` | string | Conditionnel* | Code postal origine |
| `origin_city` | string | Conditionnel* | Ville d'origine |
| `dest_country` | string | Oui | Code pays ISO destination |
| `dest_postal_code` | string | Conditionnel* | Code postal destination |
| `dest_city` | string | Conditionnel* | Ville de destination |
| `weight` | number | Non | Poids en kg |
| `volume` | number | Non | Volume en mÂ³ |
| `sort_by` | string | Non | Tri : `cost` (dÃ©faut), `delivery_time` |
| `limit` | number | Non | Nombre max de rÃ©sultats (dÃ©faut: 10) |

*\* Conditionnel : Au moins `postal_code` OU `city` requis pour origine et destination*

#### Exemples de requÃªtes valides

```bash
# Recherche par ville uniquement
POST /api/v1/match
{
  "origin_country": "FR",
  "origin_city": "Paris",
  "dest_country": "BE",
  "dest_city": "Brussels",
  "weight": 500
}

# Recherche par code postal uniquement
POST /api/v1/match
{
  "origin_country": "FR",
  "origin_postal_code": "75001",
  "dest_country": "BE",
  "dest_postal_code": "1000",
  "weight": 500
}

# Recherche mixte (ville + code postal)
POST /api/v1/match
{
  "origin_country": "FR",
  "origin_city": "Paris",
  "origin_postal_code": "75001",
  "dest_country": "BE",
  "dest_city": "Brussels",
  "weight": 500
}
```

#### RÃ©ponse (erreur de validation - 400)

```json
{
  "detail": "L'origine doit contenir au moins un code postal ou une ville"
}
```

#### RÃ©ponse (succÃ¨s - 200)

```json
{
  "quotes": [
    {
      "id": "uuid",
      "partner_id": "uuid",
      "transport_mode": "ROAD",
      "origin_city": "Paris",
      "origin_country": "FR",
      "dest_city": "Brussels",
      "dest_country": "BE",
      "cost": "120.50",
      "currency": "EUR",
      "delivery_time": "48h"
    }
  ],
  "total": 1
}
```

### 7.4 GÃ©nÃ©rer un devis

```bash
POST /api/v1/generated-quotes
Content-Type: application/json

{
  "customer_id": "uuid",
  "items": [
    {"id": "quote-uuid-1", "cost": 120.50},
    {"id": "quote-uuid-2", "cost": 180.00}
  ],
  "valid_until": "2026-02-28T00:00:00Z"
}
```

**RÃ©ponse**
```json
{
  "id": "uuid",
  "quote_number": "DEV-20260124-A1B2C3",
  "total_amount": "300.50",
  "currency": "EUR",
  "status": "DRAFT",
  "created_at": "2026-01-24T10:30:00Z"
}
```

### 7.5 Supprimer tous les tarifs d'un partenaire

#### Description

Supprime l'ensemble des tarifs (`PartnerQuote`) associÃ©s Ã  un partenaire donnÃ©.
Cette action est irrÃ©versible et nÃ©cessite une confirmation cÃ´tÃ© interface.

#### Cas d'utilisation

- RÃ©initialiser les tarifs avant un nouvel import
- Nettoyer les donnÃ©es obsolÃ¨tes d'un partenaire
- Supprimer les tarifs d'un partenaire dÃ©sactivÃ©

#### RequÃªte

```bash
DELETE /api/v1/partners/{partner_id}/quotes

# Exemple
curl -X DELETE http://localhost:3000/api/v1/partners/a619635b-32b3-4003-9953-5c71dc1c5007/quotes
```

#### ParamÃ¨tres

| ParamÃ¨tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| `partner_id` | UUID | Oui | Identifiant unique du partenaire |

#### RÃ©ponse (succÃ¨s - 200)

```json
{
  "message": "Tarifs supprimÃ©s avec succÃ¨s",
  "partner_id": "a619635b-32b3-4003-9953-5c71dc1c5007",
  "deleted_count": 1620
}
```

#### RÃ©ponse (partenaire non trouvÃ© - 404)

```json
{
  "detail": "Partenaire non trouvÃ©"
}
```

#### RÃ©ponse (aucun tarif - 200)

```json
{
  "message": "Aucun tarif Ã  supprimer",
  "partner_id": "a619635b-32b3-4003-9953-5c71dc1c5007",
  "deleted_count": 0
}
```

#### Interface utilisateur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Supprimer les tarifs                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  âš ï¸  Attention : Cette action est irrÃ©versible !                    â”‚
â”‚                                                                     â”‚
â”‚  Vous Ãªtes sur le point de supprimer tous les tarifs                â”‚
â”‚  du partenaire "DHL Express".                                       â”‚
â”‚                                                                     â”‚
â”‚  Nombre de tarifs concernÃ©s : 1,620                                 â”‚
â”‚                                                                     â”‚
â”‚  Pour confirmer, tapez le code du partenaire : DHL                  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚                          [Annuler]  [Supprimer]                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Flux de suppression

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Bouton    â”‚â”€â”€â”€â”€>â”‚   Modal     â”‚â”€â”€â”€â”€>â”‚   API       â”‚â”€â”€â”€â”€>â”‚   Toast     â”‚
â”‚  "Supprimer â”‚     â”‚ Confirmationâ”‚     â”‚   DELETE    â”‚     â”‚   SuccÃ¨s    â”‚
â”‚   tarifs"   â”‚     â”‚ + Saisie    â”‚     â”‚             â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ Annulation
                          v
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Fermer    â”‚
                    â”‚   Modal     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 AutocomplÃ©tion des villes âœ… ImplÃ©mentÃ©

#### Description

Retourne une liste de villes correspondant Ã  la recherche, basÃ©e sur les villes prÃ©sentes dans les tarifs importÃ©s.
UtilisÃ© pour l'autocomplÃ©tion dans le formulaire de recherche.

#### RequÃªte

```bash
GET /api/v1/cities/suggest?q={query}&type={origin|dest}&limit={limit}

# Exemples
curl "http://localhost:3000/api/v1/cities/suggest?q=par&type=origin&limit=10"
curl "http://localhost:3000/api/v1/cities/suggest?q=lyon&type=dest"
```

#### ParamÃ¨tres

| ParamÃ¨tre | Type | Requis | DÃ©faut | Description |
|-----------|------|--------|--------|-------------|
| `q` | string | Oui | - | Terme de recherche (min 2 caractÃ¨res) |
| `type` | string | Non | `both` | Type de ville : `origin`, `dest`, ou `both` |
| `limit` | int | Non | 10 | Nombre max de suggestions |

#### RÃ©ponse (succÃ¨s - 200)

```json
{
  "suggestions": [
    {
      "city": "Paris",
      "country": "FR",
      "quote_count": 1250
    },
    {
      "city": "Paray-le-Monial",
      "country": "FR",
      "quote_count": 45
    },
    {
      "city": "Parthenay",
      "country": "FR",
      "quote_count": 12
    }
  ],
  "total": 3
}
```

#### RÃ©ponse (requÃªte trop courte - 400)

```json
{
  "detail": "Le terme de recherche doit contenir au moins 2 caractÃ¨res"
}
```

#### Algorithme de recherche

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Recherche de villes                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. Normalisation du terme (lowercase, trim)                        â”‚
â”‚                                                                     â”‚
â”‚  2. RequÃªte SQL :                                                   â”‚
â”‚     SELECT DISTINCT city, country, COUNT(*) as quote_count          â”‚
â”‚     FROM partner_quotes                                             â”‚
â”‚     WHERE LOWER(origin_city) LIKE 'par%'                            â”‚
â”‚        OR LOWER(dest_city) LIKE 'par%'                              â”‚
â”‚     GROUP BY city, country                                          â”‚
â”‚     ORDER BY quote_count DESC                                       â”‚
â”‚     LIMIT 10                                                        â”‚
â”‚                                                                     â”‚
â”‚  3. Retour JSON avec suggestions triÃ©es par pertinence              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ImplÃ©mentation Frontend

```typescript
// Composant React avec debounce et navigation clavier
const [query, setQuery] = useState('');
const [suggestions, setSuggestions] = useState([]);
const [activeIndex, setActiveIndex] = useState(-1);
const [isOpen, setIsOpen] = useState(false);

// Debounce pour la recherche
useEffect(() => {
  if (query.length < 2) {
    setSuggestions([]);
    setIsOpen(false);
    return;
  }

  const timer = setTimeout(async () => {
    const response = await api.get('/cities/suggest', {
      params: { q: query, type: 'origin' }
    });
    setSuggestions(response.data.suggestions);
    setIsOpen(true);
    setActiveIndex(-1);
  }, 300);

  return () => clearTimeout(timer);
}, [query]);

// Gestion du clavier
const handleKeyDown = (e: React.KeyboardEvent) => {
  if (!isOpen || suggestions.length === 0) return;

  switch (e.key) {
    case 'ArrowDown':
      e.preventDefault();
      setActiveIndex(prev =>
        prev < suggestions.length - 1 ? prev + 1 : 0
      );
      break;
    case 'ArrowUp':
      e.preventDefault();
      setActiveIndex(prev =>
        prev > 0 ? prev - 1 : suggestions.length - 1
      );
      break;
    case 'Enter':
    case 'Tab':
      if (activeIndex >= 0) {
        e.preventDefault();
        selectCity(suggestions[activeIndex]);
      }
      break;
    case 'Escape':
      setIsOpen(false);
      setActiveIndex(-1);
      break;
  }
};

const selectCity = (city: CitySuggestion) => {
  setQuery(`${city.city} (${city.country})`);
  setIsOpen(false);
  onSelect(city); // Callback parent
};
```

#### Rendu JSX

```tsx
<div className="relative">
  <input
    value={query}
    onChange={(e) => setQuery(e.target.value)}
    onKeyDown={handleKeyDown}
    onFocus={() => suggestions.length > 0 && setIsOpen(true)}
    placeholder="Rechercher une ville..."
  />

  {isOpen && suggestions.length > 0 && (
    <ul className="absolute w-full bg-white border rounded-lg shadow-lg mt-1 max-h-60 overflow-auto">
      {suggestions.map((city, index) => (
        <li
          key={`${city.city}-${city.country}`}
          className={`px-4 py-2 cursor-pointer flex justify-between
            ${index === activeIndex ? 'bg-blue-100' : 'hover:bg-gray-100'}`}
          onClick={() => selectCity(city)}
          onMouseEnter={() => setActiveIndex(index)}
        >
          <span>ğŸ“ {city.city} ({city.country})</span>
          <span className="text-gray-400 text-sm">{city.quote_count} tarifs</span>
        </li>
      ))}
    </ul>
  )}
</div>
```

### 7.7 API Devis Clients âœ… ImplÃ©mentÃ©

#### CrÃ©er un devis

```bash
POST /api/v1/customer-quotes
Content-Type: application/json

{
  "customer_name": "SociÃ©tÃ© ABC",
  "customer_email": "contact@abc.fr",
  "customer_company": "SARL ABC",
  "valid_until": "2026-02-28"
}
```

**RÃ©ponse (201)**
```json
{
  "id": "uuid",
  "reference": "DEV-2026-0042",
  "status": "DRAFT",
  "customer_name": "SociÃ©tÃ© ABC",
  "items": [],
  "transport_subtotal": 0,
  "fees_total": 0,
  "total": 0,
  "total_margin": 0
}
```

#### Ajouter un transport au devis

```bash
POST /api/v1/customer-quotes/{quote_id}/items
Content-Type: application/json

{
  "partner_quote_id": "uuid-du-tarif",
  "weight": 500
}
```

**RÃ©ponse (201)**
```json
{
  "id": "item-uuid",
  "item_type": "TRANSPORT",
  "description": "Paris â†’ Lyon",
  "origin_city": "Paris",
  "dest_city": "Lyon",
  "partner_name": "DHL Express",
  "transport_mode": "ROAD",
  "delivery_time": "24h",
  "weight": 500,
  "cost_price": 150.00,
  "margin_percent": 15.00,
  "margin_amount": 22.50,
  "sell_price": 172.50
}
```

#### Modifier la marge d'une ligne

```bash
PUT /api/v1/customer-quotes/{quote_id}/items/{item_id}
Content-Type: application/json

{
  "margin_percent": 20.00
}
```

**RÃ©ponse (200)** - Recalcul automatique du prix de vente
```json
{
  "id": "item-uuid",
  "cost_price": 150.00,
  "margin_percent": 20.00,
  "margin_amount": 30.00,
  "sell_price": 180.00
}
```

#### Ajouter une ligne de frais

```bash
POST /api/v1/customer-quotes/{quote_id}/fees
Content-Type: application/json

{
  "description": "Frais de dossier",
  "sell_price": 25.00
}
```

**RÃ©ponse (201)**
```json
{
  "id": "fee-uuid",
  "item_type": "FEE",
  "description": "Frais de dossier",
  "cost_price": 0,
  "sell_price": 25.00,
  "margin_percent": 100,
  "margin_amount": 25.00
}
```

#### Modifier les informations client

```bash
PUT /api/v1/customer-quotes/{quote_id}
Content-Type: application/json

{
  "customer_name": "Nouveau Nom",
  "customer_company": "Nouvelle SociÃ©tÃ©",
  "customer_email": "nouveau@email.fr",
  "valid_until": "2026-03-15"
}
```

#### Supprimer un devis (DRAFT uniquement)

```bash
DELETE /api/v1/customer-quotes/{quote_id}
```

**RÃ©ponse (200)**
```json
{
  "message": "Devis supprimÃ© avec succÃ¨s"
}
```

**RÃ©ponse (400)** - Si le statut n'est pas DRAFT
```json
{
  "detail": "Seuls les devis en brouillon peuvent Ãªtre supprimÃ©s"
}
```

---

## 8. Stack technique

### 8.1 Technologies

| Composant | Technologie |
|-----------|-------------|
| Backend | Python 3.12 + FastAPI |
| Base de donnÃ©es | PostgreSQL 16 |
| ORM | SQLAlchemy + Alembic |
| Parsing CSV/Excel | pandas + openpyxl |
| Parsing PDF | pdfplumber |
| GÃ©nÃ©ration PDF | reportlab |
| Email | aiosmtplib |
| Cache | Redis |

### 8.2 Structure du projet

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ partner.py
â”‚   â”‚   â”œâ”€â”€ partner_quote.py
â”‚   â”‚   â”œâ”€â”€ import_job.py
â”‚   â”‚   â”œâ”€â”€ customer.py
â”‚   â”‚   â””â”€â”€ generated_quote.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ partner.py
â”‚   â”‚   â”œâ”€â”€ partner_quote.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ partners.py
â”‚   â”‚   â”œâ”€â”€ quotes.py
â”‚   â”‚   â”œâ”€â”€ imports.py
â”‚   â”‚   â”œâ”€â”€ matching.py
â”‚   â”‚   â”œâ”€â”€ generated_quotes.py
â”‚   â”‚   â””â”€â”€ customer_quotes.py      # âœ… Devis clients (Panier)
â”‚   â”‚
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ import_service.py
â”‚       â”œâ”€â”€ matching_service.py
â”‚       â””â”€â”€ quote_generator.py
â”‚
â”œâ”€â”€ alembic/
â”‚   â””â”€â”€ versions/
â”‚
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ partners/
â”‚       â””â”€â”€ example.yaml
â”‚
â”œâ”€â”€ uploads/
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ alembic.ini
â””â”€â”€ Dockerfile

frontend/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ CustomerQuotes.tsx          # âœ… Liste des devis clients
â”‚   â”œâ”€â”€ CustomerQuoteDetail.tsx     # âœ… DÃ©tail d'un devis
â”‚   â”œâ”€â”€ CustomerQuoteEditor.tsx     # âœ… Ã‰diteur de devis (marges, frais)
â”‚   â”œâ”€â”€ Results.tsx                 # âœ… RÃ©sultats + bouton "Ajouter au devis"
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ customer-quote/
â”‚   â”‚   â”œâ”€â”€ QuoteSidebar.tsx        # âœ… Panel latÃ©ral "Devis en cours"
â”‚   â”‚   â”œâ”€â”€ QuoteItem.tsx           # âœ… Ligne de devis (sidebar)
â”‚   â”‚   â””â”€â”€ editor/
â”‚   â”‚       â”œâ”€â”€ QuoteItemEditor.tsx # âœ… Ligne Ã©ditable (marge)
â”‚   â”‚       â”œâ”€â”€ AddFeeModal.tsx     # âœ… Modal ajout de frais
â”‚   â”‚       â””â”€â”€ EditCustomerModal.tsx # âœ… Modal Ã©dition client
â”‚   â”‚
â”‚   â”œâ”€â”€ SearchModal.tsx             # âœ… Modal de recherche
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ context/
â”‚   â””â”€â”€ CustomerQuoteContext.tsx    # âœ… Context pour le devis en cours
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ customerQuoteService.ts     # âœ… API calls pour devis clients
â”‚
â””â”€â”€ types/
    â””â”€â”€ customerQuote.ts            # âœ… Types TypeScript
```

### 8.3 DÃ©pendances

```txt
# requirements.txt

fastapi==0.109.2
uvicorn[standard]==0.27.1
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
alembic==1.13.1
pydantic==2.6.1
pydantic-settings==2.1.0
pandas==2.2.0
openpyxl==3.1.2
pdfplumber==0.10.3
reportlab==4.0.9
redis==5.0.1
python-multipart==0.0.9
pyyaml==6.0.1
```

---

## 9. DÃ©ploiement

### 9.1 Docker Compose

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/transport_quote
      REDIS_HOST: redis
      REDIS_PORT: 6379
    volumes:
      - ./backend/uploads:/app/uploads
      - ./backend/configs:/app/configs
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: transport_quote
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

### 9.2 Variables d'environnement

```bash
# .env

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/transport_quote

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# Storage
UPLOAD_DIR=./uploads
PARTNER_CONFIGS_DIR=./configs/partners

# Email (optionnel)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=noreply@example.com
SMTP_PASSWORD=password
```

### 9.3 DÃ©marrage

```bash
# Installation
cd backend
pip install -r requirements.txt

# Migrations
alembic revision --autogenerate -m "initial"
alembic upgrade head

# DÃ©veloppement
uvicorn app.main:app --reload --port 3000

# Avec Docker
docker-compose up -d
```

---

## RÃ©sumÃ©

Application en 4 modules principaux :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     IMPORT      â”‚     â”‚    MATCHING     â”‚     â”‚  DEVIS CLIENT   â”‚     â”‚   GENERATOR     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â”‚ Admin uploade   â”‚â”€â”€â”€â”€>â”‚ Client cherche  â”‚â”€â”€â”€â”€>â”‚ Workflow Panier â”‚â”€â”€â”€â”€>â”‚ Devis PDF       â”‚
â”‚ fichiers tarifs â”‚     â”‚ les offres      â”‚     â”‚ Multi-trajets   â”‚     â”‚ envoyÃ© par mail â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â”‚ CSV/Excel/PDF   â”‚     â”‚ Tri par prix    â”‚     â”‚ Marges, Frais   â”‚     â”‚ (Ã€ venir)       â”‚
â”‚ â†’ Base donnÃ©es  â”‚     â”‚ ou dÃ©lai        â”‚     â”‚ Client info     â”‚     â”‚                 â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Points clÃ©s :**
- Pas d'API partenaire complexe â†’ Simple upload de fichiers
- Pas de formulaire de saisie â†’ Tout passe par les fichiers
- Admin centralise les imports â†’ ContrÃ´le qualitÃ© des donnÃ©es
- Parsing intelligent â†’ CSV, Excel, PDF supportÃ©s
- **Workflow Panier** â†’ Construction progressive du devis multi-trajets
- **Gestion des marges** â†’ Marge par dÃ©faut partenaire, ajustable par ligne
- **Frais annexes** â†’ Ajout de frais manuels (dossier, assurance...)
